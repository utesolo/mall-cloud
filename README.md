# 农业供销平台 - Mail Cloud

一个基于Spring Cloud微服务架构的农业种子供销平台，为农户和供应商提供智能化匹配、搜索和交易功能。

## 项目概述

本项目是一个完整的农业种子供销电商平台，采用微服务架构设计，包含商品管理、智能匹配、搜索、交易、用户认证等核心功能。通过机器学习算法实现供需智能匹配，提升农业种子交易效率。

## 技术架构

### 微服务架构
- **网关服务** (mall-gateway): 统一入口，路由转发
- **认证服务** (mall-auth): 用户认证和授权
- **商品服务** (mall-product): 商品管理和库存
- **交易服务** (mall-trade): 订单和购物车管理
- **搜索服务** (mall-search): Elasticsearch全文搜索
- **配置中心** (mall-config): 统一配置管理
- **文件服务** (mall-file): 文件上传管理
- **链路追踪** (mall-zipkin): 分布式链路追踪

### 核心技术栈
- **后端**: Java 21, Spring Boot 3.5, Spring Cloud 2024.0
- **数据库**: MySQL 8.0, Redis 5.0
- **搜索**: Elasticsearch 7.17
- **服务注册**: Nacos 2.4
- **远程调用**: OpenFeign
- **ORM框架**: MyBatis-Plus
- **链路追踪**: Zipkin + Brave
- **机器学习**: Python + Scikit-learn

## 功能模块

### 1. 智能供需匹配
- 基于种植计划的智能匹配算法
- 多维度匹配评分（品种、区域、气候、季节、质量、供需意图）
- 机器学习模型训练和推理
- 异步匹配任务处理

### 2. 商品搜索系统
- Elasticsearch全文搜索
- 智能搜索建议
- 多维度筛选（分类、价格、区域、品种）
- 热销商品推荐

### 3. 交易系统
- 完整购物车功能
- 订单管理（创建、支付、发货、收货）
- 用户购买记录统计
- 一周热销排行榜

### 4. 用户系统
- 微信小程序登录
- JWT Token认证
- 用户权限管理

### 5. 商品管理
- 商品CRUD操作
- 库存管理
- 分类管理
- 商品状态管理

## 项目结构

```
mail-cloud/
├── mall-auth/          # 认证服务
├── mall-common/        # 公共组件
├── mall-config/        # 配置中心
├── mall-file/          # 文件服务
├── mall-gateway/       # API网关
├── mall-product/       # 商品服务
├── mall-search/        # 搜索服务
├── mall-trade/         # 交易服务
├── mall-zipkin/        # 链路追踪
├── ml/                 # 机器学习模型
├── ml-model/           # 模型服务
└── sql/                # 数据库脚本
```

## 核心特性

### 1. 智能匹配算法
- **品种匹配**: 基于编辑距离的品种相似度计算
- **区域匹配**: 地理位置和种植环境匹配
- **气候匹配**: 温湿度等环境因素匹配
- **季节匹配**: 种植季节适配
- **质量匹配**: 发芽率、纯度等质量指标
- **供需意图匹配**: 基于描述关键词的供需匹配

### 2. 高性能搜索
- Elasticsearch全文检索
- 搜索建议和自动补全
- 实时数据同步（MySQL ↔ ES）
- 多维度复合查询

### 3. 分布式事务
- 订单创建的分布式事务处理
- 库存扣减的乐观锁机制
- 购买记录的异步保存

### 4. 数据分析
- 用户购买行为统计
- 商品热销排行分析
- 个性化推荐支持

## API接口

### 商品服务 (mall-product)
- `/product/create` - 创建商品
- `/product/update` - 更新商品
- `/product/list` - 商品列表
- `/product/detail/{id}` - 商品详情
- `/product/stock/update` - 库存更新

### 交易服务 (mall-trade)
- `/cart/add` - 添加购物车
- `/cart/list` - 购物车列表
- `/order/create` - 创建订单
- `/order/list` - 订单列表
- `/match/async` - 异步匹配任务

### 搜索服务 (mall-search)
- `/search` - 商品搜索
- `/search/hot` - 热销商品
- `/search/suggest` - 搜索建议

### 认证服务 (mall-auth)
- `/auth/wechat/login` - 微信登录
- `/auth/refresh` - Token刷新

## 部署说明

### 环境要求
- Java 21
- Maven 3.8+
- MySQL 8.0
- Redis 5.0
- Elasticsearch 7.17
- Nacos 2.4

### 启动顺序
1. 启动 Nacos 注册中心
2. 启动 MySQL 和 Redis
3. 启动 Elasticsearch
4. 启动 Zipkin 链路追踪
5. 启动各微服务应用

### 配置文件
- `application.yml` - 主配置文件
- `application-local.yml` - 本地开发配置
- 配置中心统一管理服务配置

## 机器学习模型

### 模型训练
- 特征工程：品种、区域、气候、季节、质量、供需意图
- 算法：随机森林、XGBoost
- 模型评估：准确率、召回率、F1分数

### 模型部署
- Python Flask推理服务
- REST API接口
- 实时预测能力

## 性能优化

### 缓存策略
- Redis缓存热点数据
- 本地缓存减少网络请求
- 缓存预热和更新策略

### 数据库优化
- MyBatis-Plus分页查询
- 索引优化
- 读写分离

### 搜索优化
- Elasticsearch索引优化
- 搜索结果缓存
- 分词器定制

## 监控与运维

### 链路追踪
- Zipkin分布式追踪
- 接口性能监控
- 错误定位和分析

### 日志管理
- 结构化日志输出
- 日志级别控制
- 日志聚合分析

## 扩展性设计

### 微服务拆分
- 业务边界清晰
- 独立部署和扩展
- 技术栈灵活选择

### 插件化设计
- 策略模式实现业务逻辑
- 配置驱动的功能扩展
- 事件驱动的异步处理

## 开发规范

### 代码规范
- 统一的代码风格
- 详细的JavaDoc注释
- 统一异常处理机制

### 测试规范
- 单元测试覆盖核心逻辑
- 集成测试验证服务交互
- 性能测试保障系统稳定

## 未来规划

- 实时推荐系统
- 图像识别种子品质
- 区块链溯源
- IoT设备集成
- AI种植指导

## 贡献者

农业供销平台开发团队

## 许可证

MIT License